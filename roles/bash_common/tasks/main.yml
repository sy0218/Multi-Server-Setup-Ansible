# -----------------------------------------------------
# 시스템 공통 Bash 환경 설정
# -----------------------------------------------------

- name: "Ensure /etc/job_project.conf exists"
  file:
    path: /etc/job_project.conf
    state: touch
    owner: root
    group: root
    mode: '0644'

- name: "Apply common bash settings to system targets"
  vars:
    bashrc_targets:
      - /root/.bashrc
      - /etc/skel/.bashrc
  block:
    - name: "Inject common bash configuration"
      blockinfile:
        path: "{{ item }}"
        marker: "# {mark} ANSIBLE COMMON BASH CONFIG"
        block: |
          source /etc/job_project.conf
          alias rm='rm -i'
          alias cp='cp -i'
          alias mv='mv -i'
          PS1='[\h:$PWD] '
        create: yes
      loop: "{{ bashrc_targets }}"
      loop_control:
        label: "{{ item }}"
      no_log: true

# -----------------------------------------------------
# 검증
# -----------------------------------------------------

- name: "Verify common bash config applied"
  shell: |
    grep -q "ANSIBLE COMMON BASH CONFIG" /root/.bashrc
  register: bash_check
  changed_when: false

- name: "Validation result"
  debug:
    msg: "Common bash environment is correctly applied"
  when: bash_check.rc == 0
